<html>
<head>
    <title>Draw</title>
    <style>
    *{
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        color: white;
    }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        let pX = null;
        let pY = null;
        let isDrawing = false;
        let history = [];
        let stroke = [];
        let history_length = 0;

        window.addEventListener("load", () => {
            canvas.height = window.innerHeight;
            canvas.width = window.innerWidth;
            ctx.lineWidth = 5;
        });

        window.addEventListener("mousedown", (e) => {
            isDrawing = true;
            history.length = history_length;
            pX = e.clientX;
            pY = e.clientY;
            stroke.push([pX, pY]);
        });
        window.addEventListener("mouseup", (e) => {
            isDrawing = false;
            history.push(stroke);
            history_length++;
            stroke = [];
        });
        window.addEventListener("mousemove", (e) => {
            if (!isDrawing) {
                return;
            }
            ctx.beginPath();
            ctx.moveTo(pX, pY);
            ctx.lineTo(e.clientX, e.clientY);
            ctx.stroke();
            pX = e.clientX;
            pY = e.clientY;
            stroke.push([pX, pY]);
        });
        window.addEventListener("touchstart", (e) => {
            isDrawing = true;
            history.length = history_length;
            pX = e.touches[0].clientX;
            pY = e.touches[0].clientY;
            stroke.push([pX, pY]);
        });
        window.addEventListener("touchend", (e) => {
            isDrawing = false;
            history.push(stroke);
            history_length++;
            stroke = [];
        });
        window.addEventListener("touchmove", (e) => {
            if (!isDrawing) {
                return;
            }
            ctx.beginPath();
            ctx.moveTo(pX, pY);
            ctx.lineTo(e.touches[0].clientX, e.touches[0].clientY);
            ctx.stroke();
            pX = e.touches[0].clientX;
            pY = e.touches[0].clientY;
            stroke.push([pX, pY]);
        });
        window.addEventListener("keydown", (e) => {
            if (e.ctrlKey && e.key === 'z'){
                if (history_length == 0){
                    return;
                }
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.beginPath();
                for (let i = 0; i < history_length-1; i++) {
                    for (let j = 1; j < history[i].length; j++) {
                        ctx.moveTo(history[i][j-1][0], history[i][j-1][1]);
                        ctx.lineTo(history[i][j][0], history[i][j][1]);
                        ctx.stroke();
                    }
                }
                history_length--;
            } else if (e.ctrlKey && e.key === 'r'){
                if (history.length == history_length){
                    return;
                }
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.beginPath();
                for (let i = 0; i < history_length+1; i++) {
                    for (let j = 1; j < history[i].length; j++) {
                        ctx.moveTo(history[i][j-1][0], history[i][j-1][1]);
                        ctx.lineTo(history[i][j][0], history[i][j][1]);
                        ctx.stroke();
                    }
                }
                history_length++;
            }
        });
    </script>
</body>
</html>
